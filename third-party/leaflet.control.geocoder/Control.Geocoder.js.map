{"version":3,"file":"Control.Geocoder.js","sources":["../src/geocoders/api.ts","../src/util.ts","../src/geocoders/arcgis.ts","../src/geocoders/bing.ts","../src/geocoders/azure.ts","../src/geocoders/google.ts","../src/geocoders/here.ts","../src/geocoders/latlng.ts","../src/geocoders/mapbox.ts","../src/geocoders/mapquest.ts","../src/geocoders/neutrino.ts","../src/geocoders/nominatim.ts","../src/geocoders/open-location-code.ts","../src/geocoders/opencage.ts","../src/geocoders/pelias.ts","../src/geocoders/photon.ts","../src/geocoders/what3words.ts","../src/control.ts","../src/index.ts"],"sourcesContent":["import * as L from 'leaflet';\n\n/**\n * Context for geocoding operations\n */\nexport interface GeocodingContext {\n  /**\n   * The map instance\n   */\n  map: L.Map;\n}\n\n/**\n * An object that represents a result from a geocoding query\n */\nexport interface GeocodingResult {\n  /**\n   * Name of found location\n   */\n  name: string;\n  /**\n   * The bounds of the location\n   */\n  bbox: L.LatLngBounds;\n  /**\n   * The center coordinate of the location\n   */\n  center: L.LatLng;\n  /**\n   * URL for icon representing result; optional\n   */\n  icon?: string;\n  /**\n   * HTML formatted representation of the name\n   */\n  html?: string;\n  /**\n   * Additional properties returned by the geocoder\n   */\n  properties?: any;\n}\n\n/**\n * An interface implemented to respond to geocoding queries\n */\nexport interface IGeocoder {\n  /**\n   * Performs a geocoding query and returns the results as promise\n   * @param query the query\n   * @param context the context for the query\n   */\n  geocode(query: string, context?: GeocodingContext): Promise<GeocodingResult[]>;\n  /**\n   * Performs a geocoding query suggestion (this happens while typing) and returns the results as promise\n   * @param query the query\n   * @param context the context for the query\n   */\n  suggest?(query: string, context?: GeocodingContext): Promise<GeocodingResult[]>;\n  /**\n   * Performs a reverse geocoding query and returns the results as promise\n   * @param location the coordinate to reverse geocode\n   * @param scale the map scale possibly used for reverse geocoding\n   */\n  reverse?(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]>;\n}\n\nexport interface GeocoderOptions {\n  /**\n   * URL of the service\n   */\n  serviceUrl: string;\n  /**\n   * Additional URL parameters (strings) that will be added to geocoding requests\n   */\n  geocodingQueryParams?: Record<string, unknown>;\n  /**\n   * Additional URL parameters (strings) that will be added to reverse geocoding requests\n   */\n  reverseQueryParams?: Record<string, unknown>;\n  /**\n   * API key to use this service\n   */\n  apiKey?: string;\n}\n\n/**\n * @internal\n */\nexport function geocodingParams(\n  options: GeocoderOptions,\n  params: Record<string, unknown>\n): Record<string, unknown> {\n  return Object.assign(params, options.geocodingQueryParams);\n}\n\n/**\n * @internal\n */\nexport function reverseParams(\n  options: GeocoderOptions,\n  params: Record<string, unknown>\n): Record<string, unknown> {\n  return Object.assign(params, options.reverseQueryParams);\n}\n","// Adapted from handlebars.js\n// https://github.com/wycats/handlebars.js/\n/**\n * @internal\n */\nconst badChars = /[&<>\"'`]/g;\n/**\n * @internal\n */\nconst possible = /[&<>\"'`]/;\n/**\n * @internal\n */\nconst escape: Record<string, string> = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#x27;',\n  '`': '&#x60;'\n};\n\n/**\n * @internal\n */\nfunction escapeChar(chr: string) {\n  return escape[chr];\n}\n\n/**\n * @internal\n */\nexport function htmlEscape(string?: string): string {\n  if (string == null) {\n    return '';\n  } else if (!string) {\n    return string + '';\n  }\n\n  // Force a string conversion as this will be done by the append regardless and\n  // the regex test will do this transparently behind the scenes, causing issues if\n  // an object's to string has escaped characters in it.\n  string = '' + string;\n\n  if (!possible.test(string)) {\n    return string;\n  }\n  return string.replace(badChars, escapeChar);\n}\n\n/**\n * @internal\n */\nexport function getJSON<T>(url: string, params: Record<string, unknown>): Promise<T> {\n  const headers = { Accept: 'application/json' };\n  const request = new URL(url);\n  Object.entries(params).forEach(([key, value]) => {\n    (Array.isArray(value) ? value : [value]).forEach(v => {\n      request.searchParams.append(key, v);\n    });\n  });\n  return fetch(request.toString(), { headers }).then(response => response.json());\n}\n\n/**\n * @internal\n */\nexport function template(str: string, data: Record<string, any>): string {\n  return str.replace(/\\{ *([\\w_]+) *\\}/g, (str, key) => {\n    let value = data[key];\n    if (value === undefined) {\n      value = '';\n    } else if (typeof value === 'function') {\n      value = value(data);\n    }\n    return htmlEscape(value);\n  });\n}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport { IGeocoder, GeocoderOptions, geocodingParams, GeocodingResult, reverseParams } from './api';\n\nexport interface ArcGisOptions extends GeocoderOptions {}\n\n/**\n * Implementation of the [ArcGIS geocoder](https://developers.arcgis.com/features/geocoding/)\n */\nexport class ArcGis implements IGeocoder {\n  options: ArcGisOptions = {\n    serviceUrl: 'https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer',\n    apiKey: ''\n  };\n\n  constructor(options?: Partial<ArcGisOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  async geocode(query: string): Promise<GeocodingResult[]> {\n    const params = geocodingParams(this.options, {\n      token: this.options.apiKey,\n      SingleLine: query,\n      outFields: 'Addr_Type',\n      forStorage: false,\n      maxLocations: 10,\n      f: 'json'\n    });\n\n    const data = await getJSON<ArcGisResponse>(\n      this.options.serviceUrl + '/findAddressCandidates',\n      params\n    );\n    return data.candidates.map((loc): GeocodingResult => {\n      const center = new L.LatLng(loc.location.y, loc.location.x);\n      const bbox = new L.LatLngBounds(\n        new L.LatLng(loc.extent.ymax, loc.extent.xmax),\n        new L.LatLng(loc.extent.ymin, loc.extent.xmin)\n      );\n      return {\n        name: loc.address,\n        bbox,\n        center\n      };\n    });\n  }\n\n  suggest(query: string): Promise<GeocodingResult[]> {\n    return this.geocode(query);\n  }\n\n  async reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const params = reverseParams(this.options, {\n      location: location.lng + ',' + location.lat,\n      distance: 100,\n      f: 'json'\n    });\n    const data = await getJSON<any>(this.options.serviceUrl + '/reverseGeocode', params);\n    if (!data || data.error) {\n      return [];\n    }\n    const center = new L.LatLng(data.location.y, data.location.x);\n    const bbox = new L.LatLngBounds(center, center);\n    return [\n      {\n        name: data.address.Match_addr,\n        center,\n        bbox\n      }\n    ];\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link ArcGis}\n * @param options the options\n */\nexport function arcgis(options?: Partial<ArcGisOptions>) {\n  return new ArcGis(options);\n}\n\n/**\n * @internal\n */\nexport interface ArcGisResponse {\n  spatialReference: {\n    wkid: number;\n    latestWkid: number;\n  };\n  candidates: Candidate[];\n}\n\ninterface Candidate {\n  address: string;\n  location: {\n    x: number;\n    y: number;\n  };\n  score: number;\n  attributes: {\n    Addr_Type: string;\n  };\n  extent: {\n    xmin: number;\n    ymin: number;\n    xmax: number;\n    ymax: number;\n  };\n}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport { GeocoderOptions, geocodingParams, GeocodingResult, IGeocoder, reverseParams } from './api';\n\nexport interface BingOptions extends GeocoderOptions {}\n\n/**\n * Implementation of the [Bing Locations API](https://docs.microsoft.com/en-us/bingmaps/rest-services/locations/)\n *\n * Bing Maps for Enterprise is deprecated and will be retired.\n * Free (Basic) account customers can continue to use Bing Maps for Enterprise services until June 30th, 2025.\n * Enterprise account customers can continue to use Bing Maps for Enterprise services until June 30th, 2028.\n */\nexport class Bing implements IGeocoder {\n  options: BingOptions = {\n    serviceUrl: 'https://dev.virtualearth.net/REST/v1/Locations/'\n  };\n\n  constructor(options?: Partial<BingOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  async geocode(query: string): Promise<GeocodingResult[]> {\n    const params = geocodingParams(this.options, {\n      query: query,\n      key: this.options.apiKey\n    });\n    const data = await getJSON<any>(this.options.serviceUrl, params);\n    return this._parseResults(data);\n  }\n\n  async reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const params = reverseParams(this.options, {\n      key: this.options.apiKey\n    });\n    const data = await getJSON<any>(\n      this.options.serviceUrl + location.lat + ',' + location.lng,\n      params\n    );\n    return this._parseResults(data);\n  }\n\n  private _parseResults(data) {\n    return data.resourceSets[0].resources.map((resource): GeocodingResult => {\n      const bbox = resource.bbox;\n      return {\n        name: resource.name,\n        bbox: new L.LatLngBounds([bbox[0], bbox[1]], [bbox[2], bbox[3]]),\n        center: new L.LatLng(...resource.point.coordinates as [number,number])\n      };\n    });\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Bing}\n * @param options the options\n */\nexport function bing(options?: Partial<BingOptions>) {\n  return new Bing(options);\n}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport { GeocodingResult, IGeocoder } from './api';\n\nexport interface AzureMapsOptions {\n  apiKey: string; // Azure Maps API Key\n  serviceUrl: string; // Optional: Base URL for the Azure Maps API\n}\n\n/**\n * Implementation of [Azure Maps Geocoding](https://www.microsoft.com/en-us/maps/azure/location-services/geocoding)\n *\n * https://learn.microsoft.com/en-us/rest/api/maps/search?view=rest-maps-1.0\n */\nexport class AzureMaps implements IGeocoder {\n  private options: AzureMapsOptions = {\n    apiKey: '',\n    serviceUrl: 'https://atlas.microsoft.com/search'\n  };\n\n  constructor(options: Partial<AzureMapsOptions>) {\n    L.Util.setOptions(this, options);\n    if (!this.options.apiKey) {\n      throw new Error('Azure Maps Geocoder requires an API key.');\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   * https://learn.microsoft.com/en-us/rest/api/maps/search/get-search-address?view=rest-maps-1.0&tabs=HTTP\n   */\n  async geocode(query: string): Promise<GeocodingResult[]> {\n    const params = {\n      'api-version': '1.0',\n      query,\n      'subscription-key': this.options.apiKey\n    };\n    const url = this.options.serviceUrl + '/address/json';\n    const data = await getJSON<AzureMapsResponse>(url, params);\n\n    return (data.results || []).map(\n      (result): GeocodingResult => ({\n        name: result.address.freeformAddress,\n        bbox: new L.LatLngBounds(\n          [result.viewport.topLeftPoint.lat, result.viewport.topLeftPoint.lon],\n          [result.viewport.btmRightPoint.lat, result.viewport.btmRightPoint.lon]\n        ),\n        center: new L.LatLng(result.position.lat, result.position.lon)\n      })\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   * https://learn.microsoft.com/en-us/rest/api/maps/search/get-search-address-reverse?view=rest-maps-1.0&tabs=HTTP\n   */\n  async reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const params = {\n      'api-version': '1.0',\n      query: location.lat + ',' + location.lng,\n      'subscription-key': this.options.apiKey\n    };\n    const url = this.options.serviceUrl + '/address/reverse/json';\n    const data = await getJSON<any>(url, params);\n\n    return (data.addresses || []).map(\n      (address): GeocodingResult => ({\n        name: address.address.freeformAddress,\n        bbox: new L.LatLngBounds(\n          [address.viewport.topLeftPoint.lat, address.viewport.topLeftPoint.lon],\n          [address.viewport.btmRightPoint.lat, address.viewport.btmRightPoint.lon]\n        ),\n        center: new L.LatLng(location.lat, location.lng)\n      })\n    );\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Azure}\n * @param options the options\n */\nexport function azure(options: AzureMapsOptions) {\n  return new AzureMaps(options);\n}\n\n/**\n * @internal\n */\nexport interface AzureMapsResponse {\n  summary: Summary;\n  results: Result[];\n}\n\ninterface Result {\n  type: string;\n  id: string;\n  score: number;\n  address: Address;\n  position: Position;\n  viewport: Viewport;\n  entryPoints: EntryPoint[];\n}\n\ninterface Address {\n  streetNumber: string;\n  streetName: string;\n  municipalitySubdivision: string;\n  municipality: string;\n  countrySecondarySubdivision: string;\n  countryTertiarySubdivision: string;\n  countrySubdivisionCode: string;\n  postalCode: string;\n  extendedPostalCode: string;\n  countryCode: string;\n  country: string;\n  countryCodeISO3: string;\n  freeformAddress: string;\n  countrySubdivisionName: string;\n}\n\ninterface EntryPoint {\n  type: string;\n  position: Position;\n}\n\ninterface Position {\n  lat: number;\n  lon: number;\n}\n\ninterface Viewport {\n  topLeftPoint: Position;\n  btmRightPoint: Position;\n}\n\ninterface Summary {\n  query: string;\n  queryType: string;\n  queryTime: number;\n  numResults: number;\n  offset: number;\n  totalResults: number;\n  fuzzyLevel: number;\n}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport { IGeocoder, GeocoderOptions, geocodingParams, GeocodingResult, reverseParams } from './api';\n\n/**\n * Implementation of the [Google Geocoding API](https://developers.google.com/maps/documentation/geocoding/)\n */\nexport interface GoogleOptions extends GeocoderOptions {}\n\nexport class Google implements IGeocoder {\n  options: GoogleOptions = {\n    serviceUrl: 'https://maps.googleapis.com/maps/api/geocode/json'\n  };\n\n  constructor(options?: Partial<GoogleOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  async geocode(query: string): Promise<GeocodingResult[]> {\n    const params = geocodingParams(this.options, {\n      key: this.options.apiKey,\n      address: query\n    });\n    const data = await getJSON<GoogleResponse>(this.options.serviceUrl, params);\n    return this._parseResults(data);\n  }\n\n  async reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const params = reverseParams(this.options, {\n      key: this.options.apiKey,\n      latlng: location.lat + ',' + location.lng\n    });\n    const data = await getJSON<any>(this.options.serviceUrl, params);\n    return this._parseResults(data);\n  }\n\n  private _parseResults(data: GoogleResponse) {\n    return (data.results || [])?.map((loc): GeocodingResult => {\n      const center = new L.LatLng(loc.geometry.location.lat, loc.geometry.location.lng);\n      const bbox = new L.LatLngBounds(\n        new L.LatLng(loc.geometry.viewport.northeast.lat, loc.geometry.viewport.northeast.lng),\n        new L.LatLng(loc.geometry.viewport.southwest.lat, loc.geometry.viewport.southwest.lng)\n      );\n      return {\n        name: loc.formatted_address,\n        bbox,\n        center,\n        properties: loc.address_components\n      };\n    });\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Google}\n * @param options the options\n */\nexport function google(options?: Partial<GoogleOptions>) {\n  return new Google(options);\n}\n\n/**\n * @internal\n */\nexport interface GoogleResponse {\n  results: Result[];\n  status: string;\n}\n\ninterface Result {\n  address_components: AddressComponent[];\n  formatted_address: string;\n  geometry: Geometry;\n  place_id: string;\n  types: string[];\n}\n\ninterface AddressComponent {\n  long_name: string;\n  short_name: string;\n  types: string[];\n}\n\ninterface Geometry {\n  bounds: Bounds;\n  location: Location;\n  location_type: string;\n  viewport: Bounds;\n}\n\ninterface Bounds {\n  northeast: Location;\n  southwest: Location;\n}\n\ninterface Location {\n  lat: number;\n  lng: number;\n}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport { IGeocoder, GeocoderOptions, geocodingParams, GeocodingResult, reverseParams } from './api';\n\nexport interface HereOptions extends GeocoderOptions {\n  /**\n   * Use `apiKey` and the new `HEREv2` geocoder\n   * @deprecated\n   */\n  app_id: string;\n  /**\n   * Use `apiKey` and the new `HEREv2` geocoder\n   * @deprecated\n   */\n  app_code: string;\n  reverseGeocodeProxRadius?: any;\n  apiKey: string;\n  maxResults: number;\n}\n\n/**\n * Implementation of the [HERE Geocoder API](https://developer.here.com/documentation/geocoder/topics/introduction.html)\n */\nexport class HERE implements IGeocoder {\n  options: HereOptions = {\n    serviceUrl: 'https://geocoder.api.here.com/6.2/',\n    app_id: '',\n    app_code: '',\n    apiKey: '',\n    maxResults: 5\n  };\n\n  constructor(options?: Partial<HereOptions>) {\n    L.Util.setOptions(this, options);\n    if (options?.apiKey) throw Error('apiKey is not supported, use app_id/app_code instead!');\n  }\n\n  geocode(query: string): Promise<GeocodingResult[]> {\n    const params = geocodingParams(this.options, {\n      searchtext: query,\n      gen: 9,\n      app_id: this.options.app_id,\n      app_code: this.options.app_code,\n      jsonattributes: 1,\n      maxresults: this.options.maxResults\n    });\n    return this.getJSON(this.options.serviceUrl + 'geocode.json', params);\n  }\n\n  reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    let prox = location.lat + ',' + location.lng;\n    if (this.options.reverseGeocodeProxRadius) {\n      prox += ',' + this.options.reverseGeocodeProxRadius;\n    }\n    const params = reverseParams(this.options, {\n      prox,\n      mode: 'retrieveAddresses',\n      app_id: this.options.app_id,\n      app_code: this.options.app_code,\n      gen: 9,\n      jsonattributes: 1,\n      maxresults: this.options.maxResults\n    });\n    return this.getJSON(this.options.serviceUrl + 'reversegeocode.json', params);\n  }\n\n  async getJSON(url: string, params: any): Promise<GeocodingResult[]> {\n    const data = await getJSON<any>(url, params);\n    return (data.response.view?.[0]?.result || []).map((result): GeocodingResult => {\n      const loc = result.location;\n      const center = new L.LatLng(loc.displayPosition.latitude, loc.displayPosition.longitude);\n      const bbox = new L.LatLngBounds(\n        new L.LatLng(loc.mapView.topLeft.latitude, loc.mapView.topLeft.longitude),\n        new L.LatLng(loc.mapView.bottomRight.latitude, loc.mapView.bottomRight.longitude)\n      );\n      return {\n        name: loc.address.label,\n        properties: loc.address,\n        bbox,\n        center\n      };\n    });\n  }\n}\n\n/**\n * Implementation of the new [HERE Geocoder API](https://developer.here.com/documentation/geocoding-search-api/api-reference-swagger.html)\n */\nexport class HEREv2 implements IGeocoder {\n  options: HereOptions = {\n    serviceUrl: 'https://geocode.search.hereapi.com/v1',\n    apiKey: '',\n    app_id: '',\n    app_code: '',\n    maxResults: 10\n  };\n\n  constructor(options?: Partial<HereOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  geocode(query: string): Promise<GeocodingResult[]> {\n    const params = geocodingParams(this.options, {\n      q: query,\n      apiKey: this.options.apiKey,\n      limit: this.options.maxResults\n    });\n\n    if (!params.at && !params.in) {\n      throw Error(\n        'at / in parameters not found. Please define coordinates (at=latitude,longitude) or other (in) in your geocodingQueryParams.'\n      );\n    }\n\n    return this.getJSON(this.options.serviceUrl + '/discover', params);\n  }\n\n  reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const params = reverseParams(this.options, {\n      at: location.lat + ',' + location.lng,\n      limit: this.options.reverseGeocodeProxRadius,\n      apiKey: this.options.apiKey\n    });\n    return this.getJSON(this.options.serviceUrl + '/revgeocode', params);\n  }\n\n  async getJSON(url: string, params: any): Promise<GeocodingResult[]> {\n    const data = await getJSON<HEREv2Response>(url, params);\n    return (data.items || []).map((item): GeocodingResult => {\n      const center = new L.LatLng(item.position.lat, item.position.lng);\n      let bbox: L.LatLngBounds;\n      if (item.mapView) {\n        bbox = new L.LatLngBounds(\n          new L.LatLng(item.mapView.south, item.mapView.west),\n          new L.LatLng(item.mapView.north, item.mapView.east)\n        );\n      } else {\n        // Using only position when not provided\n        bbox = new L.LatLngBounds(\n          new L.LatLng(item.position.lat, item.position.lng),\n          new L.LatLng(item.position.lat, item.position.lng)\n        );\n      }\n      return {\n        name: item.address.label,\n        properties: item.address,\n        bbox,\n        center\n      };\n    });\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link HERE}\n * @param options the options\n */\nexport function here(options?: Partial<HereOptions>) {\n  if (options?.apiKey) {\n    return new HEREv2(options);\n  } else {\n    return new HERE(options);\n  }\n}\n\n/**\n * @internal\n */\nexport interface HEREv2Response {\n  items: Item[];\n}\n\ninterface Item {\n  title: string;\n  id: string;\n  ontologyId: string;\n  resultType: string;\n  address: Address;\n  mapView?: MapView;\n  position: Position;\n  access: Position[];\n  distance: number;\n  categories: Category[];\n  references: Reference[];\n  foodTypes: Category[];\n  contacts: Contact[];\n  openingHours: OpeningHour[];\n}\n\ninterface MapView {\n  east: number;\n  north: number;\n  south: number;\n  west: number;\n}\n\ninterface Position {\n  lat: number;\n  lng: number;\n}\n\ninterface Address {\n  label: string;\n  countryCode: string;\n  countryName: string;\n  stateCode: string;\n  state: string;\n  county: string;\n  city: string;\n  district: string;\n  street: string;\n  postalCode: string;\n  houseNumber: string;\n}\n\ninterface Category {\n  id: string;\n  name: string;\n  primary?: boolean;\n}\n\ninterface Contact {\n  phone: Email[];\n  fax: Email[];\n  www: Email[];\n  email: Email[];\n}\n\ninterface Email {\n  value: string;\n}\n\ninterface OpeningHour {\n  text: string[];\n  isOpen: boolean;\n  structured: Structured[];\n}\n\ninterface Structured {\n  start: string;\n  duration: string;\n  recurrence: string;\n}\n\ninterface Reference {\n  supplier: Supplier;\n  id: string;\n}\n\ninterface Supplier {\n  id: string;\n}\n","import * as L from 'leaflet';\nimport { IGeocoder, GeocodingResult } from './api';\n\nexport interface LatLngOptions {\n  /**\n   * The next geocoder to use for non-supported queries\n   */\n  next?: IGeocoder;\n  /**\n   * The size in meters used for passing to `LatLng.toBounds`\n   */\n  sizeInMeters: number;\n}\n\n/**\n * Parses basic latitude/longitude strings such as `'50.06773 14.37742'`, `'N50.06773 W14.37742'`, `'S 50° 04.064 E 014° 22.645'`, or `'S 50° 4′ 03.828″, W 14° 22′ 38.712″'`\n * @param query the latitude/longitude string to parse\n * @returns the parsed latitude/longitude\n */\nexport function parseLatLng(query: string): L.LatLng | undefined {\n  let match;\n  // regex from https://github.com/openstreetmap/openstreetmap-website/blob/master/app/controllers/geocoder_controller.rb\n  if ((match = query.match(/^([NS])\\s*(\\d{1,3}(?:\\.\\d*)?)\\W*([EW])\\s*(\\d{1,3}(?:\\.\\d*)?)$/))) {\n    // [NSEW] decimal degrees\n    return new L.LatLng(\n      (/N/i.test(match[1]) ? 1 : -1) * +match[2],\n      (/E/i.test(match[3]) ? 1 : -1) * +match[4]\n    );\n  } else if (\n    (match = query.match(/^(\\d{1,3}(?:\\.\\d*)?)\\s*([NS])\\W*(\\d{1,3}(?:\\.\\d*)?)\\s*([EW])$/))\n  ) {\n    // decimal degrees [NSEW]\n    return new L.LatLng(\n      (/N/i.test(match[2]) ? 1 : -1) * +match[1],\n      (/E/i.test(match[4]) ? 1 : -1) * +match[3]\n    );\n  } else if (\n    (match = query.match(\n      /^([NS])\\s*(\\d{1,3})°?\\s*(\\d{1,3}(?:\\.\\d*)?)?['′]?\\W*([EW])\\s*(\\d{1,3})°?\\s*(\\d{1,3}(?:\\.\\d*)?)?['′]?$/\n    ))\n  ) {\n    // [NSEW] degrees, decimal minutes\n    return new L.LatLng(\n      (/N/i.test(match[1]) ? 1 : -1) * (+match[2] + +match[3] / 60),\n      (/E/i.test(match[4]) ? 1 : -1) * (+match[5] + +match[6] / 60)\n    );\n  } else if (\n    (match = query.match(\n      /^(\\d{1,3})°?\\s*(\\d{1,3}(?:\\.\\d*)?)?['′]?\\s*([NS])\\W*(\\d{1,3})°?\\s*(\\d{1,3}(?:\\.\\d*)?)?['′]?\\s*([EW])$/\n    ))\n  ) {\n    // degrees, decimal minutes [NSEW]\n    return new L.LatLng(\n      (/N/i.test(match[3]) ? 1 : -1) * (+match[1] + +match[2] / 60),\n      (/E/i.test(match[6]) ? 1 : -1) * (+match[4] + +match[5] / 60)\n    );\n  } else if (\n    (match = query.match(\n      /^([NS])\\s*(\\d{1,3})°?\\s*(\\d{1,2})['′]?\\s*(\\d{1,3}(?:\\.\\d*)?)?[\"″]?\\W*([EW])\\s*(\\d{1,3})°?\\s*(\\d{1,2})['′]?\\s*(\\d{1,3}(?:\\.\\d*)?)?[\"″]?$/\n    ))\n  ) {\n    // [NSEW] degrees, minutes, decimal seconds\n    return new L.LatLng(\n      (/N/i.test(match[1]) ? 1 : -1) * (+match[2] + +match[3] / 60 + +match[4] / 3600),\n      (/E/i.test(match[5]) ? 1 : -1) * (+match[6] + +match[7] / 60 + +match[8] / 3600)\n    );\n  } else if (\n    (match = query.match(\n      /^(\\d{1,3})°?\\s*(\\d{1,2})['′]?\\s*(\\d{1,3}(?:\\.\\d*)?)?[\"″]\\s*([NS])\\W*(\\d{1,3})°?\\s*(\\d{1,2})['′]?\\s*(\\d{1,3}(?:\\.\\d*)?)?[\"″]?\\s*([EW])$/\n    ))\n  ) {\n    // degrees, minutes, decimal seconds [NSEW]\n    return new L.LatLng(\n      (/N/i.test(match[4]) ? 1 : -1) * (+match[1] + +match[2] / 60 + +match[3] / 3600),\n      (/E/i.test(match[8]) ? 1 : -1) * (+match[5] + +match[6] / 60 + +match[7] / 3600)\n    );\n  } else if ((match = query.match(/^\\s*([+-]?\\d+(?:\\.\\d*)?)\\s*[\\s,]\\s*([+-]?\\d+(?:\\.\\d*)?)\\s*$/))) {\n    return new L.LatLng(+match[1], +match[2]);\n  }\n}\n\n/**\n * Parses basic latitude/longitude strings such as `'50.06773 14.37742'`, `'N50.06773 W14.37742'`, `'S 50° 04.064 E 014° 22.645'`, or `'S 50° 4′ 03.828″, W 14° 22′ 38.712″'`\n */\nexport class LatLng implements IGeocoder {\n  options: LatLngOptions = {\n    next: undefined,\n    sizeInMeters: 10000\n  };\n\n  constructor(options?: Partial<LatLngOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  async geocode(query: string) {\n    const center = parseLatLng(query);\n    if (center) {\n      const results: GeocodingResult[] = [\n        {\n          name: query,\n          center: center,\n          bbox: center.toBounds(this.options.sizeInMeters)\n        }\n      ];\n      return results;\n    } else if (this.options.next) {\n      return this.options.next.geocode(query);\n    } else {\n      return [];\n    }\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link LatLng}\n * @param options the options\n */\nexport function latLng(options?: Partial<LatLngOptions>) {\n  return new LatLng(options);\n}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport { IGeocoder, GeocoderOptions, geocodingParams, GeocodingResult, reverseParams } from './api';\n\nexport interface MapboxOptions extends GeocoderOptions {}\n\n/**\n * Implementation of the [Mapbox Geocoding](https://www.mapbox.com/api-documentation/#geocoding)\n */\nexport class Mapbox implements IGeocoder {\n  options: MapboxOptions = {\n    serviceUrl: 'https://api.mapbox.com/geocoding/v5/mapbox.places/'\n  };\n\n  constructor(options?: Partial<MapboxOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  _getProperties(loc: Feature) {\n    const properties = {\n      text: loc.text,\n      address: loc.address\n    };\n\n    (loc.context || []).forEach(context => {\n      const id = context.id.split('.')[0];\n      properties[id] = context.text;\n\n      // Get country code when available\n      if (context.short_code) {\n        properties['countryShortCode'] = context.short_code;\n      }\n    });\n    return properties;\n  }\n\n  async geocode(query: string): Promise<GeocodingResult[]> {\n    const url = this.options.serviceUrl + encodeURIComponent(query) + '.json';\n    const params: any = geocodingParams(this.options, {\n      access_token: this.options.apiKey\n    });\n    if (\n      params.proximity !== undefined &&\n      params.proximity.lat !== undefined &&\n      params.proximity.lng !== undefined\n    ) {\n      params.proximity = params.proximity.lng + ',' + params.proximity.lat;\n    }\n    const data = await getJSON<MapboxResponse>(url, params);\n    return this._parseResults(data);\n  }\n\n  suggest(query: string): Promise<GeocodingResult[]> {\n    return this.geocode(query);\n  }\n\n  async reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const url = this.options.serviceUrl + location.lng + ',' + location.lat + '.json';\n    const param = reverseParams(this.options, {\n      access_token: this.options.apiKey\n    });\n    const data = await getJSON<MapboxResponse>(url, param);\n    return this._parseResults(data);\n  }\n\n  private _parseResults(data: MapboxResponse): any[] | GeocodingResult[] {\n    if (!data.features?.length) {\n      return [];\n    }\n    return data.features.map((loc): GeocodingResult => {\n      const center = new L.LatLng(...loc.center.reverse() as [number, number]);\n      let bbox: L.LatLngBounds;\n      if (loc.bbox) {\n        bbox = new L.LatLngBounds(\n          new L.LatLng(...loc.bbox.slice(0, 2).reverse() as [number, number]),\n          new L.LatLng(...loc.bbox.slice(2, 4).reverse() as [number, number])\n        );\n      } else {\n        bbox = new L.LatLngBounds(center, center);\n      }\n      return {\n        name: loc.place_name,\n        bbox,\n        center,\n        properties: this._getProperties(loc)\n      };\n    });\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Mapbox}\n * @param options the options\n */\nexport function mapbox(options?: Partial<MapboxOptions>) {\n  return new Mapbox(options);\n}\n\n/**\n * @internal\n */\nexport interface MapboxResponse {\n  type: string;\n  query: string[];\n  features: Feature[];\n  attribution: string;\n}\n\ninterface Feature {\n  id: string;\n  type: string;\n  place_type: string[];\n  relevance: number;\n  properties: Properties;\n  text: string;\n  place_name: string;\n  matching_text: string;\n  matching_place_name: string;\n  center: [number, number];\n  bbox?: [number, number, number, number];\n  geometry: Geometry;\n  address: string;\n  context: Context[];\n}\n\ninterface Context {\n  id: string;\n  text: string;\n  wikidata?: string;\n  short_code?: string;\n}\n\ninterface Geometry {\n  type: string;\n  coordinates: number[];\n  interpolated: boolean;\n  omitted: boolean;\n}\n\ninterface Properties {}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport { IGeocoder, GeocoderOptions, geocodingParams, GeocodingResult, reverseParams } from './api';\n\nexport interface MapQuestOptions extends GeocoderOptions {}\n\n/**\n * Implementation of the [MapQuest Geocoding API](http://developer.mapquest.com/web/products/dev-services/geocoding-ws)\n */\nexport class MapQuest implements IGeocoder {\n  options: MapQuestOptions = {\n    serviceUrl: 'https://www.mapquestapi.com/geocoding/v1'\n  };\n\n  constructor(options?: Partial<MapQuestOptions>) {\n    L.Util.setOptions(this, options);\n    // MapQuest seems to provide URI encoded API keys,\n    // so to avoid encoding them twice, we decode them here\n    this.options.apiKey = decodeURIComponent(this.options.apiKey!);\n  }\n\n  _formatName(...parts: string[]) {\n    return parts.filter(s => !!s).join(', ');\n  }\n\n  async geocode(query: string): Promise<GeocodingResult[]> {\n    const params = geocodingParams(this.options, {\n      key: this.options.apiKey,\n      location: query,\n      limit: 5,\n      outFormat: 'json'\n    });\n    const data = await getJSON<any>(this.options.serviceUrl + '/address', params);\n    return this._parseResults(data);\n  }\n\n  async reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const params = reverseParams(this.options, {\n      key: this.options.apiKey,\n      location: location.lat + ',' + location.lng,\n      outputFormat: 'json'\n    });\n    const data = await getJSON<any>(this.options.serviceUrl + '/reverse', params);\n    return this._parseResults(data);\n  }\n\n  private _parseResults(data): GeocodingResult[] {\n    const locations = data.results?.[0]?.locations || [];\n    return locations.map((loc): GeocodingResult => {\n      const center = new L.LatLng(loc.latLng.lat, loc.latLng.lng);\n      return {\n        name: this._formatName(loc.street, loc.adminArea4, loc.adminArea3, loc.adminArea1),\n        bbox: new L.LatLngBounds(center, center),\n        center\n      };\n    });\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link MapQuest}\n * @param options the options\n */\nexport function mapQuest(options?: Partial<MapQuestOptions>) {\n  return new MapQuest(options);\n}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport { IGeocoder, GeocoderOptions, geocodingParams, GeocodingResult, reverseParams } from './api';\n\nexport interface NeutrinoOptions extends GeocoderOptions {\n  userId: string;\n}\n\n/**\n * Implementation of the [Neutrino API](https://www.neutrinoapi.com/api/geocode-address/)\n */\nexport class Neutrino implements IGeocoder {\n  options: NeutrinoOptions = {\n    userId: '',\n    apiKey: '',\n    serviceUrl: 'https://neutrinoapi.com/'\n  };\n\n  constructor(options?: Partial<NeutrinoOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  // https://www.neutrinoapi.com/api/geocode-address/\n  async geocode(query: string): Promise<GeocodingResult[]> {\n    const params = geocodingParams(this.options, {\n      apiKey: this.options.apiKey,\n      userId: this.options.userId,\n      //get three words and make a dot based string\n      address: query.split(/\\s+/).join('.')\n    });\n    const data = await getJSON<any>(this.options.serviceUrl + 'geocode-address', params);\n    if (!data.locations) {\n      return [];\n    }\n    data.geometry = data.locations[0];\n    const center = new L.LatLng(data.geometry.latitude, data.geometry.longitude);\n    const bbox = new L.LatLngBounds(center, center);\n    return [\n      {\n        name: data.geometry.address,\n        bbox,\n        center\n      }\n    ];\n  }\n\n  suggest(query: string): Promise<GeocodingResult[]> {\n    return this.geocode(query);\n  }\n\n  // https://www.neutrinoapi.com/api/geocode-reverse/\n  async reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const params = reverseParams(this.options, {\n      apiKey: this.options.apiKey,\n      userId: this.options.userId,\n      latitude: location.lat,\n      longitude: location.lng\n    });\n    const data = await getJSON<any>(this.options.serviceUrl + 'geocode-reverse', params);\n    if (data.status.status !== 200 || !data.found) {\n      return [];\n    }\n    const center = new L.LatLng(location.lat, location.lng);\n    const bbox = new L.LatLngBounds(center, center);\n    return [\n      {\n        name: data.address,\n        bbox,\n        center\n      }\n    ];\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Neutrino}\n * @param options the options\n */\nexport function neutrino(options?: Partial<NeutrinoOptions>) {\n  return new Neutrino(options);\n}\n","import * as L from 'leaflet';\nimport { template, getJSON } from '../util';\nimport { IGeocoder, GeocoderOptions, geocodingParams, GeocodingResult, reverseParams } from './api';\n\nexport type NominatimResponse = NominatimResult[];\n\nexport interface NominatimResult {\n  place_id: number;\n  licence: string;\n  osm_type: string;\n  osm_id: number;\n  boundingbox: string[];\n  lat: string;\n  lon: string;\n  display_name: string;\n  class?: string;\n  type?: string;\n  importance?: number;\n  icon?: string;\n  address: NominatimAddress;\n}\n\nexport interface NominatimAddress {\n  building?: string;\n  city_district?: string;\n  city?: string;\n  country_code?: string;\n  country?: string;\n  county?: string;\n  hamlet?: string;\n  house_number?: string;\n  neighbourhood?: string;\n  postcode?: string;\n  road?: string;\n  state_district?: string;\n  state?: string;\n  suburb?: string;\n  village?: string;\n}\n\nexport interface NominatimOptions extends GeocoderOptions {\n  /**\n   * Additional URL parameters (strings) that will be added to geocoding requests; can be used to restrict results to a specific country for example, by providing the [`countrycodes`](https://wiki.openstreetmap.org/wiki/Nominatim#Parameters) parameter to Nominatim\n   */\n  geocodingQueryParams?: Record<string, unknown>;\n  /**\n   * A function that takes an GeocodingResult as argument and returns an HTML formatted string that represents the result. Default function breaks up address in parts from most to least specific, in attempt to increase readability compared to Nominatim's naming\n   */\n  htmlTemplate: (r: NominatimResult) => string;\n}\n\n/**\n * Implementation of the [Nominatim](https://wiki.openstreetmap.org/wiki/Nominatim) geocoder.\n *\n * This is the default geocoding service used by the control, unless otherwise specified in the options.\n *\n * Unless using your own Nominatim installation, please refer to the [Nominatim usage policy](https://operations.osmfoundation.org/policies/nominatim/).\n */\nexport class Nominatim implements IGeocoder {\n  options: NominatimOptions = {\n    serviceUrl: 'https://nominatim.openstreetmap.org/',\n    htmlTemplate(r: NominatimResult) {\n      const address = r.address;\n      let className: string;\n      const parts: string[] = [];\n      if (address.road || address.building) {\n        parts.push('{building} {road} {house_number}');\n      }\n\n      if (address.city || (address as any).town || address.village || address.hamlet) {\n        className = parts.length > 0 ? 'leaflet-control-geocoder-address-detail' : '';\n        parts.push(\n          '<span class=\"' + className + '\">{postcode} {city} {town} {village} {hamlet}</span>'\n        );\n      }\n\n      if (address.state || address.country) {\n        className = parts.length > 0 ? 'leaflet-control-geocoder-address-context' : '';\n        parts.push('<span class=\"' + className + '\">{state} {country}</span>');\n      }\n\n      return template(parts.join('<br/>'), address);\n    }\n  };\n\n  constructor(options?: Partial<NominatimOptions>) {\n    L.Util.setOptions(this, options || {});\n  }\n\n  async geocode(query: string) {\n    const params = geocodingParams(this.options, {\n      q: query,\n      limit: 5,\n      format: 'json',\n      addressdetails: 1\n    });\n    const data = await getJSON<NominatimResult[]>(this.options.serviceUrl + 'search', params);\n    return data.map((item): GeocodingResult => {\n      const bbox = item.boundingbox;\n      return {\n        icon: item.icon,\n        name: item.display_name,\n        html: this.options.htmlTemplate ? this.options.htmlTemplate(item) : undefined,\n        bbox: new L.LatLngBounds([+bbox[0], +bbox[2]], [+bbox[1], +bbox[3]]),\n        center: new L.LatLng(+item.lat, +item.lon),\n        properties: item\n      };\n    });\n  }\n\n  async reverse(location: L.LatLngLiteral, scale: number) {\n    const params = reverseParams(this.options, {\n      lat: location.lat,\n      lon: location.lng,\n      zoom: Math.round(Math.log(scale / 256) / Math.log(2)),\n      addressdetails: 1,\n      format: 'json'\n    });\n    const data = await getJSON<NominatimResult>(this.options.serviceUrl + 'reverse', params);\n    if (!data?.lat || !data?.lon) {\n      return [];\n    }\n    const center = new L.LatLng(+data.lat, +data.lon);\n    const bbox = new L.LatLngBounds(center, center);\n    return [\n      {\n        name: data.display_name,\n        html: this.options.htmlTemplate ? this.options.htmlTemplate(data) : undefined,\n        center,\n        bbox,\n        properties: data\n      }\n    ];\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Nominatim}\n * @param options the options\n */\nexport function nominatim(options?: Partial<NominatimOptions>) {\n  return new Nominatim(options);\n}\n","import * as L from 'leaflet';\nimport { IGeocoder, GeocodingResult } from './api';\n\nexport interface OpenLocationCodeOptions {\n  OpenLocationCode: OpenLocationCodeApi;\n  codeLength?: number;\n}\n\nexport interface OpenLocationCodeApi {\n  encode(latitude: number, longitude: number, codeLength?: number): string;\n  decode(code: string): CodeArea;\n}\n\nexport interface CodeArea {\n  latitudeLo: number;\n  longitudeLo: number;\n  latitudeHi: number;\n  longitudeHi: number;\n  latitudeCenter: number;\n  longitudeCenter: number;\n  codeLength: number;\n}\n\n/**\n * Implementation of the [Plus codes](https://plus.codes/) (formerly OpenLocationCode) (requires [open-location-code](https://www.npmjs.com/package/open-location-code))\n */\nexport class OpenLocationCode implements IGeocoder {\n  options = {} as OpenLocationCodeOptions;\n  constructor(options?: Partial<OpenLocationCodeOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  async geocode(query: string) {\n    try {\n      const decoded = this.options.OpenLocationCode.decode(query);\n      const result: GeocodingResult = {\n        name: query,\n        center: new L.LatLng(decoded.latitudeCenter, decoded.longitudeCenter),\n        bbox: new L.LatLngBounds(\n          new L.LatLng(decoded.latitudeLo, decoded.longitudeLo),\n          new L.LatLng(decoded.latitudeHi, decoded.longitudeHi)\n        )\n      };\n      return [result];\n    } catch (e) {\n      console.warn(e); // eslint-disable-line no-console\n      return [];\n    }\n  }\n  async reverse(location: L.LatLngLiteral, scale: number) {\n    try {\n      const code = this.options.OpenLocationCode.encode(\n        location.lat,\n        location.lng,\n        this.options.codeLength\n      );\n      const result = {\n        name: code,\n        center: new L.LatLng(location.lat, location.lng),\n        bbox: new L.LatLngBounds(\n          new L.LatLng(location.lat, location.lng),\n          new L.LatLng(location.lat, location.lng)\n        )\n      };\n      return [result];\n    } catch (e) {\n      console.warn(e); // eslint-disable-line no-console\n      return [];\n    }\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link OpenLocationCode}\n * @param options the options\n */\nexport function openLocationCode(options?: Partial<OpenLocationCodeOptions>) {\n  return new OpenLocationCode(options);\n}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport { IGeocoder, GeocoderOptions, geocodingParams, GeocodingResult, reverseParams } from './api';\n\nexport interface OpenCageOptions extends GeocoderOptions {}\n\n/**\n * Implementation of the [OpenCage Data API](https://opencagedata.com/)\n */\nexport class OpenCage implements IGeocoder {\n  options: OpenCageOptions = {\n    serviceUrl: 'https://api.opencagedata.com/geocode/v1/json'\n  };\n\n  constructor(options?: Partial<OpenCageOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  async geocode(query: string): Promise<GeocodingResult[]> {\n    const params = geocodingParams(this.options, {\n      key: this.options.apiKey,\n      q: query\n    });\n    const data = await getJSON<any>(this.options.serviceUrl, params);\n    return this._parseResults(data);\n  }\n\n  suggest(query: string): Promise<GeocodingResult[]> {\n    return this.geocode(query);\n  }\n\n  async reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const params = reverseParams(this.options, {\n      key: this.options.apiKey,\n      q: [location.lat, location.lng].join(',')\n    });\n    const data = await getJSON<any>(this.options.serviceUrl, params);\n    return this._parseResults(data);\n  }\n\n  private _parseResults(data): GeocodingResult[] {\n    return (data.results || []).map((loc): GeocodingResult => {\n      const center = new L.LatLng(loc.geometry.lat, loc.geometry.lng);\n      const bbox =\n        loc.annotations && loc.annotations.bounds\n          ? new L.LatLngBounds(\n              new L.LatLng(loc.annotations.bounds.northeast.lat, loc.annotations.bounds.northeast.lng),\n              new L.LatLng(loc.annotations.bounds.southwest.lat, loc.annotations.bounds.southwest.lng)\n            )\n          : new L.LatLngBounds(center, center);\n\n      return {\n        name: loc.formatted,\n        bbox,\n        center,\n        properties: loc\n      };\n    });\n  }\n}\n\nexport function opencage(options?: Partial<OpenCageOptions>) {\n  return new OpenCage(options);\n}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport { IGeocoder, GeocoderOptions, geocodingParams, GeocodingResult, reverseParams } from './api';\n\nexport interface PeliasOptions extends GeocoderOptions {}\n\n/**\n * Implementation of the [Pelias](https://pelias.io/), [geocode.earth](https://geocode.earth/) geocoder (formerly Mapzen Search)\n */\nexport class Pelias implements IGeocoder {\n  options: PeliasOptions = {\n    serviceUrl: 'https://api.geocode.earth/v1'\n  };\n\n  constructor(options?: Partial<PeliasOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  async geocode(query: string): Promise<GeocodingResult[]> {\n    const params = geocodingParams(this.options, {\n      api_key: this.options.apiKey,\n      text: query\n    });\n    const data = await getJSON<any>(this.options.serviceUrl + '/search', params);\n    return this._parseResults(data);\n  }\n\n  async suggest(query: string): Promise<GeocodingResult[]> {\n    const params = geocodingParams(this.options, {\n      api_key: this.options.apiKey,\n      text: query\n    });\n    const data = await getJSON<any>(this.options.serviceUrl + '/autocomplete', params);\n    return this._parseResults(data);\n  }\n\n  async reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const params = reverseParams(this.options, {\n      api_key: this.options.apiKey,\n      'point.lat': location.lat,\n      'point.lon': location.lng\n    });\n    const data = await getJSON<any>(this.options.serviceUrl + '/reverse', params);\n    return this._parseResults(data);\n  }\n\n  _parseResults(data: GeoJSON.FeatureCollection<GeoJSON.Point>): GeocodingResult[] {\n    return (data.features || []).map((f): GeocodingResult => {\n      const c = f.geometry.coordinates;\n      const center = new L.LatLng(c[1], c[0]);\n\n      const bbox =\n        Array.isArray(f.bbox) && f.bbox.length === 4\n          ? new L.LatLngBounds([f.bbox[1], f.bbox[0]], [f.bbox[3], f.bbox[2]])\n          : new L.LatLngBounds(center, center);\n\n      return {\n        name: f.properties!.label,\n        center,\n        bbox,\n        properties: f.properties\n      };\n    });\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Pelias}\n * @param options the options\n */\nexport function pelias(options?: Partial<PeliasOptions>) {\n  return new Pelias(options);\n}\n\nexport const GeocodeEarth = Pelias;\nexport const geocodeEarth = pelias;\n\n/**\n * r.i.p.\n * @deprecated\n */\nexport const Mapzen = Pelias;\n/**\n * r.i.p.\n * @deprecated\n */\nexport const mapzen = pelias;\n\n/**\n * Implementation of the [Openrouteservice](https://openrouteservice.org/dev/#/api-docs/geocode) geocoder\n */\nexport class Openrouteservice extends Pelias {\n  constructor(options?: Partial<PeliasOptions>) {\n    super(\n      Object.assign(\n        {\n          serviceUrl: 'https://api.openrouteservice.org/geocode'\n        },\n        options\n      )\n    );\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Openrouteservice}\n * @param options the options\n */\nexport function openrouteservice(options?: Partial<PeliasOptions>) {\n  return new Openrouteservice(options);\n}\n\n/**\n * @internal\n */\nexport type PeliasResponse = GeoJSON.FeatureCollection<GeoJSON.Geometry, Properties> & {\n  geocoding: Geocoding;\n};\n\ninterface Identity {\n  id: string;\n  gid: string;\n  layer: string;\n  source: string;\n  source_id: string;\n}\n\ninterface Labels {\n  name: string;\n  label: string;\n  category?: string[];\n}\n\ninterface Hierarchy {\n  country_code?: string;\n\n  ocean?: string;\n  ocean_gid?: string;\n  ocean_a?: string;\n\n  marinearea?: string;\n  marinearea_gid?: string;\n  marinearea_a?: string;\n\n  continent?: string;\n  continent_gid?: string;\n  continent_a?: string;\n\n  empire?: string;\n  empire_gid?: string;\n  empire_a?: string;\n\n  country?: string;\n  country_gid?: string;\n  country_a?: string;\n\n  dependency?: string;\n  dependency_gid?: string;\n  dependency_a?: string;\n\n  macroregion?: string;\n  macroregion_gid?: string;\n  macroregion_a?: string;\n\n  region?: string;\n  region_gid?: string;\n  region_a?: string;\n\n  macrocounty?: string;\n  macrocounty_gid?: string;\n  macrocounty_a?: string;\n\n  county?: string;\n  county_gid?: string;\n  county_a?: string;\n\n  localadmin?: string;\n  localadmin_gid?: string;\n  localadmin_a?: string;\n\n  locality?: string;\n  locality_gid?: string;\n  locality_a?: string;\n\n  borough?: string;\n  borough_gid?: string;\n  borough_a?: string;\n\n  neighbourhood?: string;\n  neighbourhood_gid?: string;\n  neighbourhood_a?: string;\n\n  postalcode?: string;\n  postalcode_gid?: string;\n  postalcode_a?: string;\n}\n\ninterface Address {\n  unit?: string;\n  housenumber?: string;\n  street?: string;\n  postalcode?: string;\n}\n\ninterface Scoring {\n  accuracy: string;\n  confidence?: number;\n  distance?: number;\n  match_type?: string;\n}\n\ninterface Addendum {\n  addendum?: Record<string, Object>;\n}\n\ninterface Properties extends Identity, Labels, Scoring, Address, Hierarchy, Addendum {}\n\ninterface Geocoding {\n  version: string;\n  attribution: string;\n  query: Query;\n  warnings: string[];\n  engine: Engine;\n}\n\ninterface Engine {\n  name: string;\n  author: string;\n  version: string;\n}\n\ninterface Query {\n  size: number;\n  lang: {\n    name: string;\n    iso6391: string;\n    iso6393: string;\n    via: string;\n    defaulted: boolean\n  }\n  text?: string;\n  parser?: string;\n  parsed_text?: Record<string, string>;\n  sources?: string[];\n  layers?: string[];\n}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport {\n  GeocoderOptions,\n  GeocodingContext,\n  geocodingParams,\n  GeocodingResult,\n  IGeocoder,\n  reverseParams\n} from './api';\n\nexport interface PhotonOptions extends GeocoderOptions {\n  reverseUrl: string;\n  nameProperties: string[];\n  htmlTemplate?: (r: any) => string;\n}\n\n/**\n * Implementation of the [Photon](http://photon.komoot.io/) geocoder\n */\nexport class Photon implements IGeocoder {\n  options: PhotonOptions = {\n    serviceUrl: 'https://photon.komoot.io/api/',\n    reverseUrl: 'https://photon.komoot.io/reverse/',\n    nameProperties: ['name', 'street', 'suburb', 'hamlet', 'town', 'city', 'state', 'country']\n  };\n\n  constructor(options?: Partial<PhotonOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  async geocode(query: string, context?: GeocodingContext): Promise<GeocodingResult[]> {\n    const params = geocodingParams(this.options, { q: query });\n    const center = context?.map?.getCenter?.();\n    if (center) {\n      params.lat = center.lat;\n      params.lon = center.lng;\n    }\n    const zoom = context?.map?.getZoom?.();\n    if (zoom) {\n      params.zoom = zoom;\n    }\n    const data = await getJSON<any>(this.options.serviceUrl, params);\n    return this._parseResults(data);\n  }\n\n  suggest(query: string): Promise<GeocodingResult[]> {\n    return this.geocode(query);\n  }\n\n  async reverse(latLng: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const params = reverseParams(this.options, {\n      lat: latLng.lat,\n      lon: latLng.lng\n    });\n    const data = await getJSON<any>(this.options.reverseUrl, params);\n    return this._parseResults(data);\n  }\n\n  _parseResults(data: GeoJSON.FeatureCollection<GeoJSON.Point>): GeocodingResult[] {\n    return (data.features || []).map((f): GeocodingResult => {\n      const c = f.geometry.coordinates;\n      const center = new L.LatLng(c[1], c[0]);\n      const extent = f.properties?.extent;\n\n      const bbox = extent\n        ? new L.LatLngBounds([extent[1], extent[0]], [extent[3], extent[2]])\n        : new L.LatLngBounds(center, center);\n\n      return {\n        name: this._decodeFeatureName(f),\n        html: this.options.htmlTemplate ? this.options.htmlTemplate(f) : undefined,\n        center,\n        bbox,\n        properties: f.properties\n      };\n    });\n  }\n\n  _decodeFeatureName(f: GeoJSON.Feature) {\n    return (this.options.nameProperties || [])\n      .map(p => f.properties?.[p])\n      .filter(v => !!v)\n      .join(', ');\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Photon}\n * @param options the options\n */\nexport function photon(options?: Partial<PhotonOptions>) {\n  return new Photon(options);\n}\n\n/**\n * @internal\n */\nexport type PhotonResponse = GeoJSON.FeatureCollection<GeoJSON.Geometry, PhotonProperties>;\n\ninterface PhotonProperties {\n  osm_id: number;\n  osm_type: string;\n  extent?: number[];\n  country: string;\n  osm_key: string;\n  city: string;\n  countrycode: string;\n  osm_value: string;\n  name: string;\n  state: string;\n  type: string;\n  postcode?: string;\n  housenumber?: string;\n  street?: string;\n  district?: string;\n}\n","import * as L from 'leaflet';\nimport { getJSON } from '../util';\nimport { IGeocoder, GeocoderOptions, geocodingParams, GeocodingResult, reverseParams } from './api';\n\nexport interface What3WordsOptions extends GeocoderOptions {}\n\n/**\n * Implementation of the What3Words service\n */\nexport class What3Words implements IGeocoder {\n  options: What3WordsOptions = {\n    serviceUrl: 'https://api.what3words.com/v2/'\n  };\n\n  constructor(options: Partial<What3WordsOptions>) {\n    L.Util.setOptions(this, options);\n  }\n\n  async geocode(query: string): Promise<GeocodingResult[]> {\n    const data = await getJSON<any>(\n      this.options.serviceUrl + 'forward',\n      geocodingParams(this.options, {\n        key: this.options.apiKey,\n        //get three words and make a dot based string\n        addr: query.split(/\\s+/).join('.')\n      })\n    );\n    if (!data.geometry) {\n      return [];\n    }\n    const center = new L.LatLng(data.geometry['lat'], data.geometry['lng']);\n    const bbox = new L.LatLngBounds(center, center);\n    return [\n      {\n        name: data.words,\n        bbox,\n        center\n      }\n    ];\n  }\n\n  suggest(query: string): Promise<GeocodingResult[]> {\n    return this.geocode(query);\n  }\n\n  async reverse(location: L.LatLngLiteral, scale: number): Promise<GeocodingResult[]> {\n    const data = await getJSON<any>(\n      this.options.serviceUrl + 'reverse',\n      reverseParams(this.options, {\n        key: this.options.apiKey,\n        coords: [location.lat, location.lng].join(',')\n      })\n    );\n    if (data.status.status != 200) {\n      return [];\n    }\n    const center = new L.LatLng(data.geometry['lat'], data.geometry['lng']);\n    const bbox = new L.LatLngBounds(center, center);\n    return [\n      {\n        name: data.words,\n        bbox,\n        center\n      }\n    ];\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link What3Words}\n * @param options the options\n */\nexport function what3words(options: Partial<What3WordsOptions>) {\n  return new What3Words(options);\n}\n","import * as L from 'leaflet';\nimport { Nominatim } from './geocoders/index';\nimport { IGeocoder, GeocodingResult, GeocodingContext } from './geocoders/api';\n\nexport interface GeocoderControlOptions extends L.ControlOptions {\n  /**\n   * Collapse control unless hovered/clicked\n   */\n  collapsed: boolean;\n  /**\n   * How to expand a collapsed control: `touch` or `click` or `hover`\n   */\n  expand: 'touch' | 'click' | 'hover';\n  /**\n   * Placeholder text for text input\n   */\n  placeholder: string;\n  /**\n   * Message when no result found / geocoding error occurs\n   */\n  errorMessage: string;\n  /**\n   * Accessibility label for the search icon used by screen readers\n   */\n  iconLabel: string;\n  /**\n   * Object to perform the actual geocoding queries\n   */\n  geocoder?: IGeocoder;\n  /**\n   * Immediately show the unique result without prompting for alternatives\n   */\n  showUniqueResult: boolean;\n  /**\n   * Show icons for geocoding results (if available); supported by Nominatim\n   */\n  showResultIcons: boolean;\n  /**\n   * Minimum number characters before suggest functionality is used (if available from geocoder)\n   */\n  suggestMinLength: number;\n  /**\n   * Number of milliseconds after typing stopped before suggest functionality is used (if available from geocoder)\n   */\n  suggestTimeout: number;\n  /**\n   * Initial query string for text input\n   */\n  query: string;\n  /**\n   * Minimum number of characters in search text before performing a query\n   */\n  queryMinLength: number;\n  /**\n   * Whether to mark a geocoding result on the map by default\n   */\n  defaultMarkGeocode: boolean;\n}\n\n/**\n * Event is fired when selecting a geocode result.\n * By default, the control will center the map on it and place a marker at its location.\n * To remove the control's default handler for marking a result, set {@link GeocoderControlOptions.defaultMarkGeocode} to `false`.\n */\nexport type MarkGeocodeEvent = { geocode: GeocodingResult };\nexport type MarkGeocodeEventHandlerFn = (event: MarkGeocodeEvent) => void;\n\n/**\n * Event is fired before invoking {@link IGeocoder.geocode} (or {@link IGeocoder.suggest}).\n * The event data contains the query string as `input`.\n */\nexport type StartGeocodeEvent = { input: string };\nexport type StartGeocodeEventHandlerFn = (event: StartGeocodeEvent) => void;\n\n/**\n * Event is fired before after receiving results from {@link IGeocoder.geocode} (or {@link IGeocoder.suggest}).\n * The event data contains the query string as `input` and the geocoding `results`.\n */\nexport type FinishGeocodeEvent = { input: string; results: GeocodingResult[] };\nexport type FinishGeocodeEventHandlerFn = (event: FinishGeocodeEvent) => void;\n\ndeclare module 'leaflet' {\n  interface Evented {\n    on(type: 'markgeocode', fn: MarkGeocodeEventHandlerFn, context?: any): this;\n    on(type: 'startgeocode', fn: StartGeocodeEventHandlerFn, context?: any): this;\n    on(type: 'startsuggest', fn: StartGeocodeEventHandlerFn, context?: any): this;\n    on(type: 'finishsuggest', fn: FinishGeocodeEventHandlerFn, context?: any): this;\n    on(type: 'finishgeocode', fn: FinishGeocodeEventHandlerFn, context?: any): this;\n  }\n}\n\n/**\n * Leaflet mixins https://leafletjs.com/reference-1.7.1.html#class-includes\n * for TypeScript https://www.typescriptlang.org/docs/handbook/mixins.html\n * @internal\n */\nclass EventedControl {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(...args: any[]) {\n    // empty\n  }\n}\n\n/**\n * @internal\n */\ninterface EventedControl extends L.Control, L.Evented {}\nObject.getOwnPropertyNames(L.Control.prototype).forEach(\n  k => (EventedControl.prototype[k] = L.Control.prototype[k])\n);\nObject.getOwnPropertyNames(L.Evented.prototype).forEach(\n  k => (EventedControl.prototype[k] = L.Evented.prototype[k])\n);\n\n/**\n * This is the geocoder control. It works like any other [Leaflet control](https://leafletjs.com/reference.html#control), and is added to the map.\n */\nexport class GeocoderControl extends EventedControl {\n  options: GeocoderControlOptions = {\n    showUniqueResult: true,\n    showResultIcons: false,\n    collapsed: true,\n    expand: 'touch',\n    position: 'topright',\n    placeholder: 'Search...',\n    errorMessage: 'Nothing found.',\n    iconLabel: 'Initiate a new search',\n    query: '',\n    queryMinLength: 1,\n    suggestMinLength: 3,\n    suggestTimeout: 250,\n    defaultMarkGeocode: true\n  };\n\n  private _alts: HTMLUListElement;\n  private _container: HTMLDivElement;\n  private _errorElement: HTMLDivElement;\n  private _geocodeMarker: L.Marker;\n  private _input: HTMLInputElement;\n  private _lastGeocode: string;\n  private _map: L.Map;\n  private _preventBlurCollapse: boolean;\n  private _requestCount = 0;\n  private _results: any;\n  private _selection: any;\n  private _suggestTimeout: any;\n\n  /**\n   * Instantiates a geocoder control (to be invoked using `new`)\n   * @param options the options\n   */\n  constructor(options?: Partial<GeocoderControlOptions>) {\n    super(options);\n    L.Util.setOptions(this, options);\n    if (!this.options.geocoder) {\n      this.options.geocoder = new Nominatim();\n    }\n  }\n\n  addThrobberClass() {\n    this._container.classList.add('leaflet-control-geocoder-throbber');\n  }\n\n  removeThrobberClass() {\n    this._container.classList.remove('leaflet-control-geocoder-throbber');\n  }\n\n  /**\n   * Returns the container DOM element for the control and add listeners on relevant map events.\n   * @param map the map instance\n   * @see https://leafletjs.com/reference.html#control-onadd\n   */\n  onAdd(map: L.Map) {\n    const className = 'leaflet-control-geocoder';\n    const container = L.DomUtil.create('div', className + ' leaflet-bar');\n    const icon = L.DomUtil.create('button', className + '-icon', container);\n    const form = L.DomUtil.create('div', className + '-form', container);\n\n    this._map = map;\n    this._container = container;\n\n    icon.innerHTML = '&nbsp;';\n    icon.type = 'button';\n    icon.setAttribute('aria-label', this.options.iconLabel);\n\n    const input = (this._input = L.DomUtil.create('input', '', form));\n    input.type = 'search';\n    input.value = this.options.query;\n    input.placeholder = this.options.placeholder;\n    L.DomEvent.disableClickPropagation(input);\n\n    this._errorElement = L.DomUtil.create('div', className + '-form-no-error', container);\n    this._errorElement.innerHTML = this.options.errorMessage;\n\n    this._alts = L.DomUtil.create(\n      'ul',\n      className + '-alternatives leaflet-control-geocoder-alternatives-minimized',\n      container\n    );\n    L.DomEvent.disableClickPropagation(this._alts);\n\n    L.DomEvent.on(input, 'keydown', this._keydown, this);\n    if (this.options.geocoder?.suggest) {\n      L.DomEvent.on(input, 'input', this._change, this);\n    }\n    L.DomEvent.on(input, 'blur', () => {\n      if (this.options.collapsed && !this._preventBlurCollapse) {\n        this._collapse();\n      }\n      this._preventBlurCollapse = false;\n    });\n\n    if (this.options.collapsed) {\n      if (this.options.expand === 'click') {\n        L.DomEvent.on(container, 'click', (e: Event) => {\n          if ((e as MouseEvent).button === 0 && (e as MouseEvent).detail !== 2) {\n            this._toggle();\n          }\n        });\n      } else if (this.options.expand === 'touch') {\n        L.DomEvent.on(\n          container,\n          L.Browser.touch ? 'touchstart mousedown' : 'mousedown',\n          (e: Event) => {\n            this._toggle();\n            e.preventDefault(); // mobile: clicking focuses the icon, so UI expands and immediately collapses\n            e.stopPropagation();\n          },\n          this\n        );\n      } else {\n        L.DomEvent.on(container, 'mouseover', this._expand, this);\n        L.DomEvent.on(container, 'mouseout', this._collapse, this);\n        this._map.on('movestart', this._collapse, this);\n      }\n    } else {\n      this._expand();\n      if (L.Browser.touch) {\n        L.DomEvent.on(container, 'touchstart', () => this._geocode());\n      } else {\n        L.DomEvent.on(container, 'click', () => this._geocode());\n      }\n    }\n\n    if (this.options.defaultMarkGeocode) {\n      this.on('markgeocode', this.markGeocode, this);\n    }\n\n    this.on('startgeocode', this.addThrobberClass, this);\n    this.on('finishgeocode', this.removeThrobberClass, this);\n    this.on('startsuggest', this.addThrobberClass, this);\n    this.on('finishsuggest', this.removeThrobberClass, this);\n\n    L.DomEvent.disableClickPropagation(container);\n\n    return container;\n  }\n\n  /**\n   * Sets the query string on the text input\n   * @param string the query string\n   */\n  setQuery(string: string): this {\n    this._input.value = string;\n    return this;\n  }\n\n  private _geocodeResult(results: GeocodingResult[], suggest: boolean) {\n    if (!suggest && this.options.showUniqueResult && results.length === 1) {\n      this._geocodeResultSelected(results[0]);\n    } else if (results.length > 0) {\n      this._alts.innerHTML = '';\n      this._results = results;\n      this._alts.classList.remove('leaflet-control-geocoder-alternatives-minimized');\n      this._container.classList.add('leaflet-control-geocoder-options-open');\n      this._results.forEach((result, i) => this._alts.appendChild(this._createAlt(result, i)));\n    } else {\n      this._container.classList.add('leaflet-control-geocoder-options-error');\n      this._errorElement.classList.add('leaflet-control-geocoder-error');\n    }\n  }\n\n  /**\n   * Marks a geocoding result on the map\n   * @param result the geocoding result\n   */\n  markGeocode(event: MarkGeocodeEvent) {\n    const result = event.geocode;\n\n    this._map.fitBounds(result.bbox);\n\n    if (this._geocodeMarker) {\n      this._map.removeLayer(this._geocodeMarker);\n    }\n\n    this._geocodeMarker = new L.Marker(result.center)\n      .bindPopup(result.html || result.name)\n      .addTo(this._map)\n      .openPopup();\n\n    return this;\n  }\n\n  private async _geocode(suggest: boolean = false) {\n    const value = this._input.value;\n    if (!suggest && value.length < this.options.queryMinLength) {\n      return;\n    }\n\n    const requestCount = ++this._requestCount;\n    this._lastGeocode = value;\n    if (!suggest) {\n      this._clearResults();\n    }\n\n    const event: StartGeocodeEvent = { input: value };\n    this.fire(suggest ? 'startsuggest' : 'startgeocode', event);\n\n    const context: GeocodingContext = { map: this._map };\n    const results = suggest\n      ? await this.options.geocoder!.suggest!(value, context)\n      : await this.options.geocoder!.geocode(value, context);\n\n    if (requestCount === this._requestCount) {\n      const event: FinishGeocodeEvent = { input: value, results };\n      this.fire(suggest ? 'finishsuggest' : 'finishgeocode', event);\n      this._geocodeResult(results, suggest);\n    }\n  }\n\n  private _geocodeResultSelected(geocode: GeocodingResult) {\n    const event: MarkGeocodeEvent = { geocode };\n    this.fire('markgeocode', event);\n  }\n\n  private _toggle() {\n    if (this._container.classList.contains('leaflet-control-geocoder-expanded')) {\n      this._collapse();\n    } else {\n      this._expand();\n    }\n  }\n\n  private _expand() {\n    this._container.classList.add('leaflet-control-geocoder-expanded');\n    this._input.select();\n    this.fire('expand');\n  }\n\n  private _collapse() {\n    this._container.classList.remove('leaflet-control-geocoder-expanded');\n    this._alts.classList.add('leaflet-control-geocoder-alternatives-minimized');\n    this._errorElement.classList.remove('leaflet-control-geocoder-error');\n    this._container.classList.remove('leaflet-control-geocoder-options-open');\n    this._container.classList.remove('leaflet-control-geocoder-options-error');\n    this._input.blur(); // mobile: keyboard shouldn't stay expanded\n    this.fire('collapse');\n  }\n\n  private _clearResults() {\n    this._alts.classList.add('leaflet-control-geocoder-alternatives-minimized');\n    this._selection = null;\n    this._errorElement.classList.remove('leaflet-control-geocoder-error');\n    this._container.classList.remove('leaflet-control-geocoder-options-open');\n    this._container.classList.remove('leaflet-control-geocoder-options-error');\n  }\n\n  private _createAlt(result: GeocodingResult, index: number) {\n    const li = L.DomUtil.create('li', ''),\n      a = L.DomUtil.create('a', '', li),\n      icon = this.options.showResultIcons && result.icon ? L.DomUtil.create('img', '', a) : null,\n      text = result.html ? undefined : document.createTextNode(result.name),\n      mouseDownHandler = (e: Event) => {\n        // In some browsers, a click will fire on the map if the control is\n        // collapsed directly after mousedown. To work around this, we\n        // wait until the click is completed, and _then_ collapse the\n        // control. Messy, but this is the workaround I could come up with\n        // for #142.\n        this._preventBlurCollapse = true;\n        L.DomEvent.stop(e);\n        this._geocodeResultSelected(result);\n        L.DomEvent.on(li, 'click touchend', () => {\n          if (this.options.collapsed) {\n            this._collapse();\n          } else {\n            this._clearResults();\n          }\n        });\n      };\n\n    if (icon) {\n      icon.src = result.icon!;\n    }\n\n    li.setAttribute('data-result-index', String(index));\n\n    if (result.html) {\n      a.innerHTML = a.innerHTML + result.html;\n    } else if (text) {\n      a.appendChild(text);\n    }\n\n    // Use mousedown and not click, since click will fire _after_ blur,\n    // causing the control to have collapsed and removed the items\n    // before the click can fire.\n    L.DomEvent.on(li, 'mousedown touchstart', mouseDownHandler, this);\n\n    return li;\n  }\n\n  private _keydown(e: KeyboardEvent) {\n    const select = (dir: number) => {\n      if (this._selection) {\n        this._selection.classList.remove('leaflet-control-geocoder-selected');\n        this._selection = this._selection[dir > 0 ? 'nextSibling' : 'previousSibling'];\n      }\n      if (!this._selection) {\n        this._selection = this._alts[dir > 0 ? 'firstChild' : 'lastChild'];\n      }\n\n      if (this._selection) {\n        this._selection.classList.add('leaflet-control-geocoder-selected');\n      }\n    };\n\n    switch (e.key) {\n      case 'Escape':\n        if (this.options.collapsed) {\n          this._collapse();\n        } else {\n          this._clearResults();\n        }\n        break;\n      case 'ArrowUp':\n        select(-1);\n        break;\n      case 'ArrowDown':\n        select(1);\n        break;\n      case 'Enter':\n        if (this._selection) {\n          const index = parseInt(this._selection.getAttribute('data-result-index'), 10);\n          this._geocodeResultSelected(this._results[index]);\n          this._clearResults();\n        } else {\n          this._geocode();\n        }\n        break;\n      default:\n        return;\n    }\n\n    L.DomEvent.preventDefault(e);\n  }\n\n  private _change() {\n    const v = this._input.value;\n    if (v !== this._lastGeocode) {\n      clearTimeout(this._suggestTimeout);\n      if (v.length >= this.options.suggestMinLength) {\n        this._suggestTimeout = setTimeout(() => this._geocode(true), this.options.suggestTimeout);\n      } else {\n        this._clearResults();\n      }\n    }\n  }\n}\n\n/**\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link GeocoderControl}\n * @param options the options\n */\nexport function geocoder(options?: Partial<GeocoderControlOptions>) {\n  return new GeocoderControl(options);\n}\n","/* @preserve\n * Leaflet Control Geocoder\n * https://github.com/perliedman/leaflet-control-geocoder\n *\n * Copyright (c) 2012 sa3m (https://github.com/sa3m)\n * Copyright (c) 2018 Per Liedman\n * All rights reserved.\n */\nimport * as L from 'leaflet';\nimport { GeocoderControl as Geocoder, geocoder } from './control';\nimport * as geocoders from './geocoders/index';\nimport './style.css';\n\nObject.assign(Geocoder, geocoders);\nexport default Geocoder;\nexport { Geocoder, geocoder, geocoders };\n\nObject.assign(L.Control, {\n  Geocoder: Geocoder,\n  geocoder: geocoder\n});\n"],"names":["geocodingParams","options","params","reverseParams","badChars","possible","escape","escapeChar","chr","htmlEscape","string","getJSON","url","headers","request","key","value","v","response","template","str","data","ArcGis","L","query","loc","center","bbox","location","scale","arcgis","Bing","resource","bing","AzureMaps","result","address","azure","Google","google","HERE","prox","HEREv2","item","here","parseLatLng","match","LatLng","latLng","Mapbox","properties","context","id","param","mapbox","MapQuest","parts","s","mapQuest","Neutrino","neutrino","Nominatim","r","className","nominatim","OpenLocationCode","decoded","e","openLocationCode","OpenCage","opencage","Pelias","f","c","pelias","GeocodeEarth","geocodeEarth","Mapzen","mapzen","Openrouteservice","openrouteservice","Photon","zoom","extent","p","photon","What3Words","what3words","EventedControl","args","k","GeocoderControl","map","container","icon","form","input","results","suggest","i","event","requestCount","geocode","index","li","a","text","mouseDownHandler","select","dir","geocoder","Geocoder","geocoders"],"mappings":"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"}